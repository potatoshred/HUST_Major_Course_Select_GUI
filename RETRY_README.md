# 智能重试课程选择器

## 新增功能特性

### 🔄 连续重试功能
- **可配置重试次数**：每门课程可设置最大重试次数
- **自定义重试间隔**：重试之间的等待时间可设置（秒为单位）
- **实时状态跟踪**：显示每门课程的重试次数和状态
- **智能重试策略**：
  - 单课程重试：针对单个课程手动重试
  - 批量重试：一次性重试所有失败课程
  - 连续重试：自动循环重试直到成功或达到最大次数

### 📊 详细状态显示
- 重试进度：实时显示当前重试进度
- 失败原因：显示每次重试的具体失败原因
- 重试统计：显示每门课程的重试次数统计
- 时间戳：记录每次重试的精确时间

## 界面组件

### 重试配置面板
- **最大重试次数输入框**：设置每门课程的最大重试次数（默认3次）
- **重试间隔输入框**：设置重试之间的等待时间（默认5秒）
- **实时配置显示**：显示当前的重试配置状态

### 课程状态卡片
- **重试状态图标**：
  - ✅ 成功：绿色勾选图标
  - 🔄 重试中：加载动画
  - ❌ 失败：红色错误状态
- **重试计数器**：显示"当前重试次数/最大重试次数"
- **时间戳**：显示上次重试时间
- **状态消息**：详细的重试结果信息

### 重试控制按钮
- **重试单个课程**：针对特定课程的快速重试
- **重试所有失败课程**：批量处理所有未成功课程
- **连续重试模式**：自动循环重试直到完成
- **停止重试**：随时中断重试过程
- **重置计数**：清零所有重试统计

## 使用方法

### 1. 基础配置
```bash
cd course_selector_app
flutter pub get
```

### 2. 启动重试版本
```bash
flutter run -d windows --target lib/retry_course_selector.dart
```

### 3. 配置重试参数
1. 在"重试配置"面板中设置：
   - 最大重试次数：建议3-5次
   - 重试间隔：建议3-10秒
2. 点击任意空白处自动保存配置

### 4. 执行重试策略
- **手动重试**：点击课程卡片上的刷新按钮
- **批量重试**：点击"重试所有失败课程"按钮
- **连续重试**：点击"连续重试模式"按钮
- **紧急停止**：点击"停止重试"按钮

## 重试策略详解

### 智能重试逻辑
```
每门课程独立重试
├── 检查是否已选课成功
├── 检查重试次数是否超限
├── 执行选课操作
├── 更新重试状态
└── 等待重试间隔
```

### 失败处理
- **网络错误**：显示具体错误信息，可继续重试
- **课程不存在**：标记为未找到，跳过重试
- **教师不匹配**：继续搜索其他班级
- **选课失败**：显示失败原因，计入重试次数

### 状态持久化
- 重试计数在应用会话期间保持
- 可通过"重置计数"按钮清零
- 关闭应用后重试计数重置

## 最佳实践

### 重试参数建议
- **选课高峰期**：
  - 重试次数：5-10次
  - 重试间隔：2-5秒
- **选课低峰期**：
  - 重试次数：3-5次
  - 重试间隔：5-10秒

### 使用技巧
1. **先少量测试**：先用1-2门课程测试重试功能
2. **监控网络**：观察网络状态调整重试间隔
3. **分批处理**：大量课程可分批次重试
4. **及时停止**：发现异常及时停止重试

## 故障排除

### 常见问题
- **重试过快被限制**：增加重试间隔时间
- **网络超时**：检查Cookie和User-Agent配置
- **重试无响应**：检查网络连接状态
- **计数不增加**：确认课程是否真的执行了重试

### 调试模式
- 查看控制台输出获取详细日志
- 检查每门课程的具体状态消息
- 验证网络请求是否成功发送

## 技术实现

### 核心类结构
```
RetryCourse
├── name: 课程名称
├── teacher: 教师姓名
├── retryCount: 重试计数
├── isRetrying: 重试状态
└── lastRetryTime: 上次重试时间

RetryConfig
├── maxRetries: 最大重试次数
└── retryIntervalSeconds: 重试间隔秒数
```

### 异步重试管理
- 使用Future和async/await处理异步重试
- 状态管理通过setState实时更新UI
- 支持随时中断重试过程
- 优雅处理网络异常和错误

## 更新日志

### v2.0.0 - 重试功能版本
- ✅ 新增连续重试功能
- ✅ 新增重试配置面板
- ✅ 新增详细状态显示
- ✅ 新增批量重试模式
- ✅ 新增智能重试策略
- ✅ 新增实时状态跟踪